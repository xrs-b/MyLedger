# MyLedger - 移动账本项目需求文档

> **项目名**: MyLedger  
> **版本**: 1.0  
> **创建时间**: 2026-02-09  
> **最后更新**: 2026-02-09  
> **状态**: 开发中

---

## 一、项目概述

### 1.1 项目目标
开发移动端记账应用，支持日常记账和项目记账，提供多维度统计分析，部署在 Ubuntu 24.04 LTS 云服务器上实现 7x24 小时运行。

### 1.2 核心特性
| 特性 | 描述 |
|------|------|
| 日常记账 | 随时记录消费，独立数据 |
| 项目记账 | 有时间范围，关联消费，预算管理 |
| 二级分类 | 14个一级分类 + 44个二级分类 |
| 多维度统计 | 日常+项目交叉统计 |
| 用户系统 | 邀请码注册，首个用户为管理员 |
| 后端管理 | 管理员可管理所有数据 |
| 移动端适配 | 完美适配手机，禁止横向滚动 |

---

## 二、技术选型 (已确认)

### 2.1 前端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| **Vue.js** | 3.x | 前端框架 |
| **Vite** | 5.x | 构建工具 |
| **Vant** | 4.x | 移动端 UI 组件库 |
| **Pinia** | 2.x | 状态管理 |
| **Axios** | 1.x | HTTP 客户端 |
| **ECharts** | 5.x | 图表库 |
| **Vue Router** | 4.x | 路由管理 |

### 2.2 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| **Python** | 3.12 | 编程语言 |
| **FastAPI** | 0.115.x | Web 框架 |
| **SQLAlchemy** | 2.0.x | ORM |
| **Pydantic** | 2.5.x | 数据验证 |
| **SQLite** | - | 数据库 (轻量) |
| **JWT** | - | 认证 |

### 2.3 部署技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| **Docker** | 24.x | 容器化 |
| **Docker Compose** | 2.x | 容器编排 |
| **Nginx** | 1.24 | 反向代理 |
| **Ubuntu** | 24.04 LTS | 服务器系统 |

---

## 三、功能需求 (已确认)

### 3.1 用户系统

#### 3.1.1 用户字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键，自增 |
| username | VARCHAR(50) | 账号名，唯一 |
| password_hash | VARCHAR(255) | 加密后的密码 |
| is_admin | BOOLEAN | 是否管理员，默认 FALSE |
| is_active | BOOLEAN | 是否有效，默认 TRUE |
| created_at | DATETIME | 注册时间 |
| updated_at | DATETIME | 更新时间 |

#### 3.1.2 注册流程
```
1. 用户输入：账号名、密码、邀请码
2. 后端验证邀请码 == "vip1123"
3. 验证账号名唯一
4. 创建用户（is_admin = FALSE）
5. 如果是第1个用户，is_admin = TRUE
6. 返回成功，2秒后跳转登录页
```

#### 3.1.3 登录流程
```
1. 用户输入：账号名、密码
2. 后端验证密码
3. 返回 JWT Token
4. 前端保存 Token，跳转首页
```

#### 3.1.4 邀请码
- **固定值**: `vip1123`
- **验证方式**: 字符串比对

---

### 3.2 日常记账

#### 3.2.1 记账字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键 |
| user_id | INTEGER | 用户ID |
| type | VARCHAR(10) | income 或 expense |
| category_id | INTEGER | 一级分类ID |
| category_item_id | INTEGER | 二级分类ID |
| amount | DECIMAL(10,2) | 金额 |
| date | DATETIME | 消费日期时间 |
| remark | VARCHAR(255) | 备注（可选） |
| payment_method_id | INTEGER | 支付方式ID（可选） |
| project_id | INTEGER | 关联项目ID（可选） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 3.2.2 操作流程
```
1. 首页点击"记一笔"
2. 选择类型（收入/支出）
3. 选择分类（一级 → 二级）
4. 输入金额
5. 可选：日期、备注、支付方式
6. 点击保存
7. 显示成功提示
8. 返回列表页
```

---

### 3.3 项目记账

#### 3.3.1 项目字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键 |
| user_id | INTEGER | 创建者ID |
| title | VARCHAR(100) | 项目标题 |
| start_date | DATE | 开始日期（用户填写） |
| end_date | DATE | 结束日期（用户填写） |
| budget | DECIMAL(10,2) | 预算金额（用户填写） |
| member_count | INTEGER | 参与人数（用户填写） |
| total_expense | DECIMAL(10,2) | 已消费金额，自动计算 |
| status | VARCHAR(20) | 进行中/已完成 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 3.3.2 人均费用计算
```python
人均费用 = total_expense / member_count
```

#### 3.3.3 项目记账流程
```
1. 项目列表页 → 点击项目 → 进入详情页
2. 点击"记一笔"按钮
3. 跳转记账界面（自动显示项目标题）
4. 填写记账信息
5. 提交 → 记录关联到项目 + 显示在日常记账中
```

#### 3.3.4 关联逻辑
- 项目期间的消费记录需要关联项目
- 关联记录同时显示在：
  - 日常记账列表
  - 项目详情页的消费列表

---

### 3.4 二级分类

#### 3.4.1 支出分类 (10个一级)
| 一级分类 | 二级分类 |
|----------|----------|
| 餐饮 | 外卖/餐厅、食材杂货、饮料零食、下午茶/咖啡 |
| 交通 | 飞机、高铁、地铁/公交、打车/自驾、共享单车 |
| 购物 | 服装/鞋子、电子产品、日用品、化妆品、家居用品 |
| 娱乐 | 电影/演出、游戏/充值、旅游/门票、运动健身 |
| 住房 | 房租/房贷、水电费、物业费、装修材料 |
| 通讯 | 电话费、网络费 |
| 人情 | 送礼、红包/份子钱、聚会请客 |
| 医疗 | 药品、医院/诊所、保健品 |
| 教育 | 学费/培训费、书籍/资料、学习用品 |
| 其他 | 宠物、理财亏损、捐款、罚款、未知消费 |

#### 3.4.2 收入分类 (4个一级)
| 一级分类 | 二级分类 |
|----------|----------|
| 工资 | 固定工资、奖金/提成、加班费 |
| 副业 | 兼职、自由职业、卖二手 |
| 投资 | 股票收益、基金收益、利息收入 |
| 其他 | 红包收入、退款、报销、意外之财 |

#### 3.4.3 支付方式
| 支付方式 |
|----------|
| 现金 |
| 银行卡 |
| 支付宝 |
| 微信 |
| 信用卡 |
| 电子钱包 |

#### 3.4.4 初始化
- 部署时自动初始化分类数据
- 支持用户自定义分类

---

### 3.5 统计报表

#### 3.5.1 筛选条件
| 条件 | 说明 |
|------|------|
| 日期范围 | 开始日期 + 结束日期（具体到日） |
| 分类 | 默认全部分类，可选一级/二级 |
| 数据来源 | 日常记账 + 项目关联记账（交叉统计） |

#### 3.5.2 统计维度
| 维度 | 说明 |
|------|------|
| 时间维度 | 按日/周/月/年汇总 |
| 类型维度 | 收入/支出/净收入 |
| 分类维度 | 一级分类汇总、二级分类明细、占比 |
| 项目维度 | 项目关联消费、非项目消费 |
| 支付维度 | 各支付方式统计 |
| 对比分析 | 环比（vs上月）、同比（vs去年） |

#### 3.5.3 可视化图表
| 图表类型 | 说明 |
|----------|------|
| 收支趋势折线图 | 时间范围内的收支变化 |
| 分类占比饼图 | 各分类占比 |
| 收支对比柱状图 | 收入 vs 支出 |

---

### 3.6 后端管理

#### 3.6.1 访问控制
- **路径**: `/admin`
- **权限**: 只有 is_admin = TRUE 的用户可访问

#### 3.6.2 管理功能
| 功能 | 操作 |
|------|------|
| 用户管理 | 查看、编辑、删除 |
| 记账列表 | 查看、编辑、删除 |
| 分类管理 | 查看、新增、编辑、删除 |
| 项目列表 | 查看、编辑、删除 |

---

## 四、用户体验要求 (已确认)

### 4.1 移动端适配
- ✅ 禁止横向滚动
- ✅ 完美适配各种手机屏幕
- ✅ 响应式设计

### 4.2 设计风格
- ✅ 有设计感（阴影、圆角、渐变）
- ✅ 层次分明
- ✅ 色彩搭配舒适
- ❌ 拒绝扁平化

### 4.3 交互规范
| 规范 | 说明 |
|------|------|
| 页面边距 | 16px (左右) |
| 主按钮尺寸 | ≥ 48px × 120px |
| 图标按钮 | ≥ 44px × 44px |
| 操作提示 | 成功/失败/加载都有 Toast 提示 |
| 返回按钮 | 二级页面左上角必须有返回 |

### 4.4 导航结构
```
┌─────────────────────────────────────┐
│ 🏠 首页                              │
├─────────────────────────────────────┤
│ 📊 统计                              │
├─────────────────────────────────────┤
│ 📝 记一笔                            │
├─────────────────────────────────────┤
│ 📂 项目                              │
├─────────────────────────────────────┤
│ 👤 我的                              │
└─────────────────────────────────────┘
```

---

## 五、数据模型

### 5.1 数据表
| 表名 | 说明 |
|------|------|
| users | 用户表 |
| categories | 一级分类表 |
| category_items | 二级分类表 |
| payment_methods | 支付方式表 |
| records | 记账记录表 |
| projects | 项目表 |

### 5.2 关系
```
users ───< records ───< projects
  │          │
  └──< categories ───< category_items
  │
  └──< payment_methods
```

---

## 六、API 设计

### 6.1 认证模块
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/v1/auth/register | 注册 |
| POST | /api/v1/auth/login | 登录 |
| POST | /api/v1/auth/logout | 登出 |
| GET | /api/v1/auth/me | 获取当前用户 |

### 6.2 记账模块
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/v1/records | 记账列表 |
| POST | /api/v1/records | 创建记录 |
| GET | /api/v1/records/{id} | 记录详情 |
| PUT | /api/v1/records/{id} | 更新记录 |
| DELETE | /api/v1/records/{id} | 删除记录 |

### 6.3 项目模块
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/v1/projects | 项目列表 |
| POST | /api/v1/projects | 创建项目 |
| GET | /api/v1/projects/{id} | 项目详情 |
| PUT | /api/v1/projects/{id} | 更新项目 |
| DELETE | /api/v1/projects/{id} | 删除项目 |

### 6.4 统计模块
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/v1/statistics/summary | 汇总统计 |
| GET | /api/v1/statistics/by-category | 分类统计 |
| GET | /api/v1/statistics/by-project | 项目统计 |
| GET | /api/v1/statistics/trend | 趋势分析 |

### 6.5 分类模块
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/v1/categories | 分类列表 |
| GET | /api/v1/categories/items | 二级分类列表 |
| GET | /api/v1/payment-methods | 支付方式列表 |

### 6.6 管理模块 (需管理员)
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/v1/admin/users | 用户列表 |
| PUT | /api/v1/admin/users/{id} | 更新用户 |
| DELETE | /api/v1/admin/users/{id} | 删除用户 |
| GET | /api/v1/admin/records | 所有记录 |
| DELETE | /api/v1/admin/records/{id} | 删除记录 |
| GET | /api/v1/admin/categories | 分类管理 |
| POST | /api/v1/admin/categories | 新增分类 |
| PUT | /api/v1/admin/categories/{id} | 更新分类 |
| DELETE | /api/v1/admin/categories/{id} | 删除分类 |

---

## 七、部署方案

### 7.1 服务器要求
| 配置 | 要求 |
|------|------|
| CPU | 1 核 |
| 内存 | 1GB |
| 磁盘 | 10GB |
| 系统 | Ubuntu 24.04 LTS |

### 7.2 Docker 部署
```bash
docker-compose up -d --build
```

### 7.3 域名配置
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        root /var/www/mobile-ledger/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:8000;
    }
}
```

---

## 八、开发计划

### Phase 1: 项目基础框架
- [ ] 1.1 创建项目结构
- [ ] 1.2 后端基础框架 (FastAPI, 数据库)
- [ ] 1.3 前端基础框架 (Vue 3, Vant)
- [ ] 1.4 Docker 配置

### Phase 2: 用户认证系统
- [ ] 2.1 用户模型和 CRUD
- [ ] 2.2 JWT 认证
- [ ] 2.3 注册/登录页面
- [ ] 2.4 首个用户自动成为管理员

### Phase 3: 分类系统
- [ ] 3.1 分类模型
- [ ] 3.2 初始化默认分类数据
- [ ] 3.3 分类 API
- [ ] 3.4 分类选择组件

### Phase 4: 日常记账
- [ ] 4.1 记账模型
- [ ] 4.2 记账 CRUD API
- [ ] 4.3 记一笔页面
- [ ] 4.4 记账列表页面

### Phase 5: 项目记账
- [ ] 5.1 项目模型
- [ ] 5.2 项目 CRUD API
- [ ] 5.3 项目列表页面
- [ ] 5.4 项目详情页面 (含关联记录)
- [ ] 5.5 项目记账功能

### Phase 6: 统计报表
- [ ] 6.1 统计 API
- [ ] 6.2 筛选组件 (日期范围、分类)
- [ ] 6.3 统计页面
- [ ] 6.4 图表展示 (饼图、折线图)

### Phase 7: 后端管理
- [ ] 7.1 管理员中间件
- [ ] 7.2 管理 API
- [ ] 7.3 管理页面

### Phase 8: 部署优化
- [ ] 8.1 Docker 部署测试
- [ ] 8.2 云服务器部署
- [ ] 8.3 域名配置
- [ ] 8.4 HTTPS 配置

---

## 九、项目信息

| 项目 | 值 |
|------|------|
| **项目名** | MyLedger |
| **GitHub** | https://github.com/xrs-b/MyLedger |
| **本地路径** | ~/Projects/mobile-ledger |
| **Token** | 已保存到 ~/.openclaw/workspace/.github-config |

---

## 十、进度追踪

| Phase | 状态 | 开始时间 | 完成时间 |
|-------|------|----------|----------|
| Phase 1: 基础框架 | ⏳ 待开始 | - | - |
| Phase 2: 用户认证 | ⏳ 待开始 | - | - |
| Phase 3: 分类系统 | ⏳ 待开始 | - | - |
| Phase 4: 日常记账 | ⏳ 待开始 | - | - |
| Phase 5: 项目记账 | ⏳ 待开始 | - | - |
| Phase 6: 统计报表 | ⏳ 待开始 | - | - |
| Phase 7: 后端管理 | ⏳ 待开始 | - | - |
| Phase 8: 部署优化 | ⏳ 待开始 | - | - |

---

## 十一、关键提醒

### 11.1 开发中断预防
- ✅ 所有需求已文档化
- ✅ 使用 Git 版本控制
- ✅ 每个任务完成后立即提交
- ✅ 详细记录开发进度

### 11.2 用户体验要求
- ✅ 禁止横向滚动
- ✅ 按钮尺寸 ≥ 44px
- ✅ 所有操作有提示
- ✅ 返回按钮固定左上角
- ✅ 有设计感，拒绝扁平化

---

*文档版本: 1.0*
*最后更新: 2026-02-09*
*作者: 小圆 (AI Assistant)*
